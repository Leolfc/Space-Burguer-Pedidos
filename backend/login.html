<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Painel Space Burguer</title>
    <link rel="stylesheet" href="/painel/styleAdm.css" />
    <style>
      .senha-container {
        position: relative;
      }
      .senha-container input {
        padding-right: 45px;
      }
      .toggle-senha {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        font-size: 18px;
        color: #666;
        padding: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .toggle-senha:hover {
        color: #ff5722;
      }
      .toggle-senha:focus {
        outline: none;
      }
    </style>
  </head>
  <body>
    <div class="painel-container" style="max-width: 400px">
      <h1 style="text-align: center; color: #ff5722">Login do Painel</h1>
      <form id="form-login" action="/login" method="post">
        <div class="form-group">
          <label for="email">Email</label>
          <input 
          placeholder="Digite seu email"
            type="email" 
            id="email"
            name="email" 
            autocomplete="username"
            required 
          />
        </div>
        <div class="form-group">
          <label for="senha">Senha</label>
          <div class="senha-container">
            <input 
              type="password" 
              id="senha" 
              name="senha"
              autocomplete="new-password"
              placeholder="Digite sua senha"
              required
            />
            <button 
              type="button" 
              class="toggle-senha" 
              id="toggleSenha"
              aria-label="Mostrar/ocultar senha"
            >
              üëÅÔ∏è
            </button>
          </div>
        </div>
        <button type="submit" class="btn-submit">Entrar</button>
      </form>
    </div>

    <script >
      // Fun√ß√£o para mostrar/ocultar senha
      const toggleSenha = document.getElementById("toggleSenha");
      const inputSenha = document.getElementById("senha");
      
      toggleSenha.addEventListener("click", () => {
        const tipo = inputSenha.getAttribute("type") === "password" ? "text" : "password";
        inputSenha.setAttribute("type", tipo);
        toggleSenha.textContent = tipo === "password" ? "üëÅÔ∏è" : "üôà";
      });

      // Limpar campos ao carregar a p√°gina (seguran√ßa adicional)
      window.addEventListener("load", () => {
        document.getElementById("email").value = "";
        document.getElementById("senha").value = "";
      });

      document
        .getElementById("form-login")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("email").value.trim();
          const senha = document.getElementById("senha").value;

          // Valida√ß√£o b√°sica
          if (!email || !senha) {
            alert("Por favor, preencha todos os campos!");
            return;
          }

          try {
            const response = await fetch(
              "/login",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, senha }),
              }
            );
          
            if (response.ok) {
              // Limpa os campos ap√≥s login bem-sucedido
              document.getElementById("email").value = "";
              document.getElementById("senha").value = "";
            
              // Salva a "chave" no navegador (apenas para refer√™ncia, n√£o √© usado para autentica√ß√£o)
              sessionStorage.setItem('isLoggedIn', 'true');
             document.getElementById("email").value = "";
              document.getElementById("senha").value = "";
              const div = document.createElement("div")
              div.className = "notificacao"
              div.textContent = "Seja bem vindo RodrigoüöÄ"
              
              document.body.appendChild(div)
              setTimeout(() => {
                div.remove()
              }, 3000)
              // Redireciona para o painel de admin usando replace para evitar hist√≥rico
              window.location.replace("/admin");
            } else {
              const text = await response.text();
              let data = null;
               try { data = JSON.parse(text); } catch {}
              alert((data && data.message) ? data.message : "Email ou senha incorretos!");
              document.getElementById("senha").value = "";
               document.getElementById("senha").focus();
            }
          } catch (error) {
            console.error("Erro ao tentar fazer login:", error);
            alert("Erro ao tentar fazer login. Verifique sua conex√£o.");
          }
        });
        
    </script>
  </body>
</html>